TraceReq - это веб‑приложение на Flask для ведения требований и их трассировки внутри проектов.
Система позволяет:

- создавать и администрировать проекты;
- вести реестр требований разных типов;
- управлять статусами и приоритетами требований;
- связывать требования между собой (матрица трассировки);
- хранить историю изменений;
- импортировать требования из `.docx`;
- экспортировать список требований и матрицу связей в Excel.

---

## 1. Возможности системы

### 1.1 Управление проектами
- Создание проекта (название обязательно).
- Редактирование названия и описания.
- Удаление проекта вместе со связанными требованиями и связями.

### 1.2 Управление требованиями
- Создание требования в рамках выбранного проекта.
- Поддержка типов требований:
  - Бизнес‑требование
  - Функциональное требование
  - Нефункциональное требование
  - Пользовательское требование
  - Требование к интерфейсу
- Поддержка статусов:
  - Черновик
  - В работе
  - На проверке
  - Утверждено
  - Отклонено
- Поддержка приоритетов:
  - Низкий
  - Средний
  - Высокий
  - Критический
- Обновление и удаление требований.
- Просмотр истории изменений по каждому требованию.

### 1.3 Трассировка и связи
- Создание направленных связей между требованиями:
  - Реализует
  - Зависит от
  - Противоречит
- Получение матрицы связности требований внутри проекта.
- Удаление связей.

### 1.4 Импорт и экспорт
- **Импорт из DOCX**: пакетное создание требований из структурированного документа.
- **Экспорт в XLSX**:
  - полный список требований + таблица связей;
  - матрица трассировки (квадратная матрица source → target).

---

## 2. Технологический стек

- **Backend**: Python, Flask, Flask Blueprint
- **ORM и БД**: SQLAlchemy, Flask‑SQLAlchemy, SQLite (по умолчанию)
- **Шаблоны/UI**: Jinja2, HTML/CSS/JS
- **Работа с файлами**:
  - `python-docx` для импорта
  - `openpyxl` для экспорта

---

## 3. Архитектура и структура проекта

```text
TraceReq/
├── app.py                    # Точка входа Flask-приложения
├── run_app.py                # Скрипт автозапуска (venv + зависимости + app)
├── config.py                 # Конфигурация приложения
├── database.py               # Инициализация SQLAlchemy
├── logic.py                  # Бизнес-логика (CRUD, матрица, история)
├── api/
│   └── routes.py             # REST API маршруты
├── models/
│   ├── project.py            # Модель проекта
│   ├── requirement.py        # Модель требования + enum'ы
│   ├── link.py               # Модель связи требований
│   └── history.py            # Модель истории изменений
├── services/
│   ├── docx_import_service.py# Парсинг DOCX
│   ├── export_service.py     # Экспорт в Excel
│   └── text_normalizer.py    # Нормализация текста
├── templates/                # HTML-шаблоны
├── static/                   # JS/CSS
└── requirements.txt          # Python-зависимости
```

### Логические слои
- **API слой (`api/routes.py`)**: принимает HTTP‑запросы, валидирует входные данные, возвращает JSON/файлы.
- **Домен/бизнес‑слой (`logic.py`)**: правила создания, обновления, удаления, построение матрицы, сохранение истории.
- **Слой данных (`models/*`)**: ORM‑модели и связи между сущностями.
- **Сервисный слой (`services/*`)**: импорт/экспорт и вспомогательная обработка данных.

---

## 4. Данные и доменная модель

### 4.1 Project
Сущность проекта, в котором живут требования.

Основные поля:
- `id`
- `name` (уникальное)
- `description`
- `created_at`

### 4.2 Requirement
Ключевая сущность системы.

Основные поля:
- `id`
- `project_id`
- `title`
- `description`
- `requirement_type`
- `status`
- `priority`
- `source`
- `author`
- `created_at`
- `updated_at`

### 4.3 Link
Направленная связь между требованиями.

Основные поля:
- `id`
- `source_requirement_id`
- `target_requirement_id`
- `link_type`

### 4.4 RequirementHistory
Журнал изменений требований.

Основные поля:
- `id`
- `requirement_id`
- `change_type` (`CREATE` / `UPDATE` / `DELETE`)
- `old_values` (JSON)
- `new_values` (JSON)
- `changed_by`
- `changed_at`

---

## 5. REST API (основные маршруты)

Базовый префикс: `/api`

### Проекты
- `POST /projects` - создать проект
- `GET /projects` - список проектов
- `PUT /projects/{project_id}` - обновить проект
- `DELETE /projects/{project_id}` - удалить проект

### Требования
- `GET /projects/{project_id}/requirements` - список требований со связями
- `POST /projects/{project_id}/requirements` - создать требование
- `GET /projects/{project_id}/requirements/{requirement_id}` - получить требование
- `PUT /projects/{project_id}/requirements/{requirement_id}` - обновить требование
- `DELETE /projects/{project_id}/requirements/{requirement_id}` - удалить требование
- `GET /projects/{project_id}/requirements/{requirement_id}/history` - история изменения

### Импорт/экспорт
- `POST /projects/{project_id}/requirements/import/docx` - импорт требований из DOCX
- `GET /projects/{project_id}/export` - экспорт требований и связей в XLSX
- `GET /projects/{project_id}/export/matrix` - экспорт матрицы связей в XLSX

### Связи
- `POST /projects/{project_id}/links` - создать связь
- `DELETE /links/{link_id}` - удалить связь
- `GET /projects/{project_id}/matrix` - получить матрицу связей (JSON)

---

## 6. Формат импорта из DOCX

Импорт ожидает документ, в котором требования сгруппированы по секциям вида `<...>`.
Текст требований читается из пунктов списка внутри активной секции.

Пример структуры:

```text
<Бизнес-требования>
- Система должна ...
- Пользователь должен иметь возможность ...

<Функциональные требования>
- Сервис должен ...

<конец>
```

Сопоставление заголовков секций с внутренними типами регулируется настройкой
`REQUIREMENT_TYPE_ALIASES` в `config.py`.

---

## 7. Конфигурация

Поддерживаются переменные окружения:

- `SECRET_KEY` — секрет Flask (по умолчанию `dev-secret-key`)
- `DATABASE_URL` — строка подключения SQLAlchemy
  - по умолчанию: `sqlite:///requirements_trace.db`

Дополнительно в `config.py` задается словарь `REQUIREMENT_TYPE_ALIASES` для импорта.

---

## 8. Запуск проекта

### Вариант A: через `run_app.py`
Скрипт сам создаст `.venv`, установит зависимости и запустит приложение.

```bash
python run_app.py
```

### Вариант B: вручную

```bash
python -m venv .venv
source .venv/bin/activate      # Linux/macOS
# .venv\Scripts\activate       # Windows
pip install -r requirements.txt
python app.py
```
